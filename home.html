<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AfricaBased - Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script type="module" src="js/supabaseClient.js"></script>
  <script type="module" src="js/auth.js"></script>
    <style>
      /* Hide menu button when menu is open */
      .menu-button.hide {
        display: none !important;
      }
      /* Responsive menu button and nav for mobile */
      @media (max-width: 768px) {
        .nav-links {
          position: absolute;
          top: 70px;
          left: 0;
          right: 0;
          background: var(--nav-bg);
          flex-direction: column;
          gap: 0;
          display: none;
          box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        .nav-links.show {
          display: flex;
        }
        .navbar {
          flex-direction: row;
        }
        .menu-button {
          display: block;
        }
      }
      @media (min-width: 769px) {
        .menu-button {
          display: none;
        }
        .nav-links {
          display: flex !important;
          position: static;
          flex-direction: row;
        }
      }
      /* Sector buttons styling */
      .product-categories {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        margin-bottom: 2rem;
      }
      .category-btn {
        background: var(--accent-gradient);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0.7rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(78,205,196,0.10);
        transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
        margin-bottom: 0.5rem;
      }
      .category-btn.active {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: #fff;
        box-shadow: 0 4px 16px rgba(78,205,196,0.18);
        transform: translateY(-2px);
      }
      .category-btn:hover {
        background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
        color: #fff;
        box-shadow: 0 4px 16px rgba(78,205,196,0.18);
        transform: translateY(-2px);
      }
      :root {
        --accent: #4ecdc4;
        --accent-gradient: linear-gradient(45deg, #4ecdc4, #ff6b6b);
        --nav-bg: rgba(26,34,56,0.98);
        --text: #fff;
      }
      body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background: #0f172a;
        color: var(--text);
      }
      .navbar {
        background: var(--nav-bg);
        padding: 1rem 2rem;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      }
      .logo {
        display: flex;
        align-items: center;
        cursor: default;
        user-select: none;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--text);
        gap: 0.5rem;
      }
      .logo i {
        font-size: 2rem;
        color: var(--accent);
        pointer-events: none;
      }
      .logo span {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text);
        margin-left: 0.5rem;
        pointer-events: none;
      }
      .profile-image {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        object-fit: cover;
        margin-left: 1.2rem;
        box-shadow: 0 2px 8px rgba(78,205,196,0.15);
        border: 2px solid var(--accent);
        cursor: pointer;
      }
      .nav-links {
        list-style: none;
        display: flex;
        gap: 2rem;
        margin: 0;
        padding: 0;
        display: none;
      }
      .nav-links.show {
        display: flex !important;
      }
      .nav-links a {
        color: var(--text);
        text-decoration: none;
        transition: all 0.3s ease;
        padding: 0.5rem 1rem;
        border-radius: 5px;
      }
      .nav-links a:hover {
        background: var(--accent-gradient);
        color: #fff;
      }
      .menu-button {
        background: none;
        border: none;
        color: var(--text);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.5rem;
        opacity: 0.7;
        transition: opacity 0.3s ease;
      }
      .menu-button:hover {
        opacity: 1;
      }
    </style>
</head>
<body>
  <nav>
  <div class="navbar">
      <div class="logo">
        <i class="fas fa-globe"></i>
        <span>AfricaBased</span>
        <img id="profileImageTop" class="profile-image" src="https://ui-avatars.com/api/?name=User&background=4ecdc4&color=fff&size=80" alt="Profile" />
        <span id="userWelcome" style="margin-left:1rem;font-size:1rem;font-weight:500;"></span>
      </div>
      <ul class="nav-links">
        <li><a href="exchange.html">Exchange</a></li>
        <li><a href="Services.html">Services</a></li>
        <li><a href="withdraw.html">Withdraw</a></li>
        <li><a href="My-products.html">My Products</a></li>
        <li><a href="deposit.html">Deposit</a></li>
        <li><a href="products.html">Products</a></li>
        <li><a href="referrals.html">Referrals</a></li>
        <li><a href="statistics.html">Statistics</a></li>
        <li><a href="profile.html">Profile</a></li>
      </ul>
      <button class="menu-button" id="menuButton">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </nav>
  <script type="module">
    import { supabase } from './js/supabaseClient.js';
    import { getCurrentUser, checkAuthState } from './js/auth.js';

    async function setUserProfile() {
      await checkAuthState();
      const user = await getCurrentUser();
      const img = document.getElementById('profileImageTop');
      const welcome = document.getElementById('userWelcome');
      if (user) {
        let name = user.user_metadata?.name || user.email || 'User';
        welcome.textContent = `Welcome, ${name}`;
        if (img) {
          img.src = user.user_metadata?.avatar_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(name) + '&background=4ecdc4&color=fff&size=80';
        }
      } else {
        welcome.textContent = '';
        if (img) img.src = 'https://ui-avatars.com/api/?name=User&background=4ecdc4&color=fff&size=80';
      }
    }
    document.addEventListener('DOMContentLoaded', setUserProfile);
    window.addEventListener('storage', setUserProfile);

    // Dynamic product loading from Supabase
    async function renderProductGrid(category = 'all') {
      const productGrid = document.getElementById('productGrid');
      if (!productGrid) return;
      let { data: products, error } = await supabase.from('products').select('*').eq('status', 'active');
      if (error || !products) products = [];
      let filtered = category === 'all' ? products : products.filter(p => p.category === category);
      if (!filtered.length) {
        productGrid.innerHTML = `<div style='color:#fff;text-align:center;font-size:1.2rem;'>No opportunities available.</div>`;
        return;
      }
      productGrid.innerHTML = filtered.map(product => `
        <div class="product-card${product.featured ? ' featured' : ''}" style="background:rgba(255,255,255,0.05); border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.2); border:1px solid rgba(255,255,255,0.1); backdrop-filter:blur(10px); position:relative;">
          <img src="${product.image_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(product.title) + '&background=4ecdc4&color=fff&size=300'}" alt="${product.title}" class="product-image" style="width:100%;height:200px;object-fit:cover;border-radius:16px 16px 0 0;">
          <div class="product-info" style="padding:1.5rem;">
            <div class="product-title" style="font-size:1.25rem; margin-bottom:0.5rem; color:var(--text);font-weight:600;">${product.title}</div>
            <div class="product-description" style="color:rgba(255,255,255,0.7); font-size:0.9rem; margin-bottom:1rem;">${product.description}</div>
            <div style="color:#ffd54f;font-size:1.1rem;font-weight:600;">KSH ${product.price ? Number(product.price).toLocaleString() : ''}</div>
          </div>
        </div>
      `).join('');
    }

    async function renderSectorButtons() {
      const sectorButtonsDiv = document.getElementById('sectorButtons');
      if (!sectorButtonsDiv) return;
      let { data: sectors, error } = await supabase.from('products').select('category').eq('status', 'active');
      if (error || !sectors) sectors = [];
      const uniqueSectors = [...new Set(sectors.map(s => s.category).filter(Boolean))];
      let html = '<button class="category-btn active" data-category="all">All Opportunities</button>';
      uniqueSectors.forEach(s => {
        html += `<button class="category-btn" data-category="${s}">${s.charAt(0).toUpperCase() + s.slice(1)}</button>`;
      });
      sectorButtonsDiv.innerHTML = html;
      sectorButtonsDiv.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          sectorButtonsDiv.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          renderProductGrid(this.getAttribute('data-category'));
        });
      });
    }

    document.addEventListener('DOMContentLoaded', async function() {
      await renderSectorButtons();
      await renderProductGrid('all');
    });
    window.addEventListener('storage', async function(e) {
      if (e.key === 'products' || e.key === 'sectors') {
        await renderSectorButtons();
        await renderProductGrid('all');
      }
    });
  </script>
  <main>
<section class="hero-section" style="background: linear-gradient(135deg, #4ecdc4 0%, #ff6b6b 100%); padding: 5rem 2rem 3rem 2rem; text-align: center; color: #fff; margin-top: 80px; border-radius: 0 0 32px 32px; box-shadow: 0 8px 32px rgba(0,0,0,0.08);">
      <h1 style="font-size:2.5rem; font-weight:700; margin-bottom:1rem;">Welcome to AfricaBased</h1>
      <p style="font-size:1.15rem; color:rgba(255,255,255,0.85); max-width:600px; margin:0 auto 2rem auto;">Connecting Africa's best opportunities, services, and products in one place. Discover, invest, and grow with us.</p>
  <a href="profile.html" class="cta-button" style="display:inline-block; padding:1rem 2.5rem; font-size:1.1rem; font-weight:600; border-radius:8px; background:var(--accent-gradient); color:#fff; text-decoration:none; box-shadow:0 4px 16px rgba(78,205,196,0.18); transition:all 0.2s;">Get Started</a>
    </section>
        <section class="products-section" style="padding: 4rem 0;">
      <div class="section-header" style="text-align:center; margin-bottom:3rem;">
        <h2 style="font-size:2.5rem; margin-bottom:1rem; background:var(--accent-gradient); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;">Investment Opportunities</h2>
        <p style="color:rgba(255,255,255,0.7); font-size:1.1rem;">Explore top investment opportunities across Africa. Filter by sector and discover new ways to grow.</p>
      </div>
      <div class="product-categories" id="sectorButtons"></div>
      <div class="product-grid" id="productGrid" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:2rem; padding:2rem 0;"></div>
    </section>
    <section class="testimonials-section" style="padding: 6rem 5%; background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));">
      <div class="section-header" style="text-align:center; margin-bottom:4rem;">
        <h2 style="font-size:2.5rem; margin-bottom:1rem; background:var(--accent-gradient); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; display:inline-block;">What Our Clients Say</h2>
        <p style="color:rgba(255,255,255,0.7); font-size:1.1rem; max-width:600px; margin:0 auto;">Hear from investors who have experienced success with AfricaBased</p>
      </div>
      <div class="testimonials-slider" style="width:100%; max-width:1200px; margin:0 auto; padding:2rem 0;">
        <div class="swiper-slide" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:16px; padding:2rem; box-shadow:0 8px 32px rgba(0,0,0,0.2); margin-bottom:2rem;">
          <div class="testimonial-content" style="text-align:center;">
            <div class="testimonial-text" style="font-size:1.1rem; line-height:1.8; color:var(--text); margin-bottom:2rem; position:relative;">"AfricaBased helped me discover new investment opportunities and grow my portfolio. Highly recommended!"</div>
            <div class="testimonial-author" style="display:flex; align-items:center; justify-content:center; gap:1rem; margin-top:2rem;">
              <img src="https://ui-avatars.com/api/?name=Jane+Doe&background=4ecdc4&color=fff&size=80" alt="Jane Doe" style="width:60px; height:60px; border-radius:50%; object-fit:cover; border:2px solid var(--accent);" />
              <div class="author-info" style="text-align:left;">
                <h4 style="color:var(--text); margin:0; font-size:1.1rem;">Jane Doe</h4>
                <p style="color:rgba(255,255,255,0.7); font-size:0.9rem; margin:0;">Investor, Kenya</p>
              </div>
            </div>
          </div>
        </div>
        <div class="swiper-slide" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:16px; padding:2rem; box-shadow:0 8px 32px rgba(0,0,0,0.2); margin-bottom:2rem;">
          <div class="testimonial-content" style="text-align:center;">
            <div class="testimonial-text" style="font-size:1.1rem; line-height:1.8; color:var(--text); margin-bottom:2rem; position:relative;">"The platform is easy to use and the support team is fantastic. I feel confident investing with AfricaBased."</div>
            <div class="testimonial-author" style="display:flex; align-items:center; justify-content:center; gap:1rem; margin-top:2rem;">
              <img src="https://ui-avatars.com/api/?name=Samuel+Oduor&background=ff6b6b&color=fff&size=80" alt="Samuel Oduor" style="width:60px; height:60px; border-radius:50%; object-fit:cover; border:2px solid var(--accent);" />
              <div class="author-info" style="text-align:left;">
                <h4 style="color:var(--text); margin:0; font-size:1.1rem;">Samuel Oduor</h4>
                <p style="color:rgba(255,255,255,0.7); font-size:0.9rem; margin:0;">Entrepreneur, Nigeria</p>
              </div>
            </div>
          </div>
        </div>
        <div class="swiper-slide" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:16px; padding:2rem; box-shadow:0 8px 32px rgba(0,0,0,0.2); margin-bottom:2rem;">
          <div class="testimonial-content" style="text-align:center;">
            <div class="testimonial-text" style="font-size:1.1rem; line-height:1.8; color:var(--text); margin-bottom:2rem; position:relative;">"AfricaBased connects me with the right opportunities and makes investing simple and secure."</div>
            <div class="testimonial-author" style="display:flex; align-items:center; justify-content:center; gap:1rem; margin-top:2rem;">
              <img src="https://ui-avatars.com/api/?name=Fatima+Mbaye&background=4ecdc4&color=fff&size=80" alt="Fatima Mbaye" style="width:60px; height:60px; border-radius:50%; object-fit:cover; border:2px solid var(--accent);" />
              <div class="author-info" style="text-align:left;">
                <h4 style="color:var(--text); margin:0; font-size:1.1rem;">Fatima Mbaye</h4>
                <p style="color:rgba(255,255,255,0.7); font-size:0.9rem; margin:0;">Business Owner, Senegal</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>
  <script>
    function renderSectorButtons() {
  const sectorButtonsDiv = document.getElementById('sectorButtons');
  if (!sectorButtonsDiv) return;
  // Get sectors from admin settings (localStorage.sectors)
  const sectorsData = JSON.parse(localStorage.getItem('sectors') || '[]');
  let html = '<button class="category-btn active" data-category="all">All Opportunities</button>';
  if (sectorsData.length) {
    sectorsData.forEach(s => {
      html += `<button class="category-btn" data-category="${s.name}">${s.name}</button>`;
    });
  } else {
    // Fallback: infer sectors from products if admin settings not set
    const products = JSON.parse(localStorage.getItem('investmentProducts') || '[]');
    const sectors = [...new Set(products.map(p => p.category))];
    sectors.forEach(s => {
      html += `<button class="category-btn" data-category="${s}">${s.charAt(0).toUpperCase() + s.slice(1)}</button>`;
    });
  }
  sectorButtonsDiv.innerHTML = html;
  sectorButtonsDiv.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      sectorButtonsDiv.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      renderProductGrid(this.getAttribute('data-category'));
    });
  });
}

const defaultProducts = [
  {
    id: 1,
    name: "Solar Farm Project",
    description: "Large-scale solar energy installation in South Africa. High ROI potential with government incentives.",
    image: "https://images.unsplash.com/photo-1509391366360-2e959784a276?w=800",
    category: "energy",
    featured: true
  },
  {
    id: 2,
    name: "Sustainable Agriculture Project",
    description: "Large-scale organic farming initiative in Kenya. Focus on export crops with established buyers.",
    image: "https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=800",
    category: "agriculture",
    featured: true
  },
  {
    id: 3,
    name: "Tech Innovation Hub",
    description: "Investment in Nigeria's fastest-growing tech hub. Supporting startups in fintech and e-commerce.",
    image: "https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=800",
    category: "technology",
    featured: false
  },
  {
    id: 4,
    name: "Luxury Eco-Resort Development",
    description: "Sustainable luxury resort project in Tanzania. Premium beachfront location with strong tourism growth.",
    image: "https://images.unsplash.com/photo-1582610116397-edb318620f90?w=800",
    category: "real-estate",
    featured: true
  }
];

function renderProductGrid(category = 'all') {
  const adminProducts = JSON.parse(localStorage.getItem('investmentProducts') || '[]');
  // Always show default products, admin cannot remove/change them
  let products = [...defaultProducts, ...adminProducts];
  const productGrid = document.getElementById('productGrid');
  if (!productGrid) return;
  let filtered = category === 'all' ? products : products.filter(p => p.category === category);
  if (!filtered.length) {
    productGrid.innerHTML = `<div style='color:#fff;text-align:center;font-size:1.2rem;'>No opportunities available.</div>`;
    return;
  }
  productGrid.innerHTML = filtered.map(product => `
    <div class="product-card${product.featured ? ' featured' : ''}" style="background:rgba(255,255,255,0.05); border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.2); border:1px solid rgba(255,255,255,0.1); backdrop-filter:blur(10px); position:relative;">
      <img src="${product.image || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(product.name) + '&background=4ecdc4&color=fff&size=300'}" alt="${product.name}" class="product-image" style="width:100%;height:200px;object-fit:cover;border-radius:16px 16px 0 0;">
      <div class="product-info" style="padding:1.5rem;">
        <div class="product-title" style="font-size:1.25rem; margin-bottom:0.5rem; color:var(--text);font-weight:600;">${product.name}</div>
        <div class="product-description" style="color:rgba(255,255,255,0.7); font-size:0.9rem; margin-bottom:1rem;">${product.description}</div>
      </div>
    </div>
  `).join('');
}

document.addEventListener('DOMContentLoaded', function() {
  renderSectorButtons();
  renderProductGrid('all');
  window.addEventListener('storage', function(e) {
    if (e.key === 'investmentProducts' || e.key === 'sectors') {
      renderSectorButtons();
      renderProductGrid('all');
    }
  });
  var menuButton = document.getElementById('menuButton');
  var navLinks = document.querySelector('.nav-links');
  function setMenuState(open) {
    if (open) {
      navLinks.classList.add('show');
      menuButton.classList.add('hide');
    } else {
      navLinks.classList.remove('show');
      menuButton.classList.remove('hide');
    }
  }
  setMenuState(false);
  if (menuButton && navLinks) {
    menuButton.addEventListener('click', function(e) {
      e.stopPropagation();
      setMenuState(true);
    });
    navLinks.addEventListener('click', function(e) {
      if (e.target.tagName === 'A') {
        setMenuState(false);
      }
    });
    document.addEventListener('click', function(e) {
      if (!navLinks.contains(e.target) && e.target !== menuButton) {
        setMenuState(false);
      }
    });
  }
});
  </script>
</body>
</html>
